"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var UserData_1 = require("../../Users/UserData/UserData");
var router_1 = require("@angular/router");
var page_1 = require("ui/page");
var provider_1 = require("../../provider");
var Sqlite = require("nativescript-sqlite");
var User = /** @class */ (function () {
    function User() {
        this.username = "";
        this.email = "";
        this.password = "";
    }
    return User;
}());
var FirstPageComponent = /** @class */ (function () {
    function FirstPageComponent(router, page, data) {
        this.router = router;
        this.page = page;
        this.data = data;
        this.array = [];
        this.userData = new UserData_1.UserData("", "");
        this.db();
        this.page.actionBarHidden = true;
        this.isLogging = true;
    }
    FirstPageComponent.prototype.db = function () {
        var _this = this;
        (new Sqlite("Fitness.db")).then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS Accounts (id INTEGER PRIMARY KEY AUTOINCREMENT, email TEXT NOT NULL, username TEXT NOT NULL, password TEXT NOT NULL, age INTEGER, gender TEXT, foot INTEGER, inches INTEGER, weight DOUBLE, image TEXT)").then(function (id) {
                _this.database = db;
                _this.readQuery();
            }, function (error) {
                alert("DB ERROR");
            });
        }, function (error) {
            alert("DB ERROR");
        });
    };
    FirstPageComponent.prototype.readQuery = function () {
        var _this = this;
        var i = 0;
        this.database.all("SELECT * FROM Accounts").then(function (rows) {
            for (var row in rows) {
                var tempUser = new User();
                tempUser.email = rows[row][1];
                tempUser.username = rows[row][2];
                tempUser.password = rows[row][3];
                _this.array[i] = tempUser;
                i++;
            }
        }, function (error) {
            alert("Select Query Error");
        });
    };
    FirstPageComponent.prototype.writeQuery = function () {
        var _this = this;
        this.database.execSQL("INSERT INTO Accounts (email, username, password, age, gender, foot, inches, weight, image) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)", [this.userData.email, this.userData.username, this.userData.password, this.userData.age, this.userData.gender, this.userData.foot, this.userData.inches, this.userData.weight, "~/Images/blank.png"]).then(function (id) {
            alert("Your Account has been Created Successfully!!");
            _this.toggleForm();
        }, function (error) {
            alert("Insert Query Error");
        });
    };
    FirstPageComponent.prototype.checkUser = function (user) {
        var count = 0;
        for (var k = 0; k < this.array.length; k++) {
            if (user.email == this.array[k].email) {
                count = 2;
                break;
            }
            if (user.username == this.array[k].username) {
                count = 1;
            }
        }
        return count;
    };
    FirstPageComponent.prototype.toggleForm = function () {
        this.isLogging = !this.isLogging;
    };
    FirstPageComponent.prototype.clearTextboxes = function () {
        this.userData.username = "";
        this.userData.email = "";
        this.userData.password = "";
    };
    FirstPageComponent.prototype.submit = function () {
        if (this.isLogging) {
            this.login();
        }
        else {
            this.signup();
        }
    };
    FirstPageComponent.prototype.login = function () {
        var count = 0;
        if (!this.userData.username || !this.userData.password) {
            alert("Kindly Provide Every Field");
            return;
        }
        else {
            this.readQuery();
            for (var i = 0; i < this.array.length; i++) {
                if (this.userData.username === this.array[i].username && this.userData.password === this.array[i].password) {
                    count = 1;
                    this.data.storage = {
                        "username": this.array[i].username,
                        "email": this.array[i].email
                    };
                    this.router.navigate(["/secondpage"]);
                    break;
                }
            }
            if (count == 0) {
                alert("Account Not Found");
            }
        }
    };
    FirstPageComponent.prototype.signup = function () {
        if (!this.userData.username || !this.userData.email || !this.userData.password || !this.userData.age || !this.userData.gender || !this.userData.foot || !this.userData.inches || !this.userData.weight) {
            alert("Kindly Provide Every Field");
            return;
        }
        else {
            var checkResult = this.checkUser(this.userData);
            if (checkResult == 0) {
                this.writeQuery();
            }
            else if (checkResult == 1) {
                alert("Username Already Taken.... Kindly Choose another one");
            }
            else if (checkResult == 2) {
                alert("Account with Email: " + this.userData.email + " Already Created...Can not Create New One!!");
            }
        }
        this.readQuery();
    };
    FirstPageComponent = __decorate([
        core_1.Component({
            selector: "firstpage",
            templateUrl: "./Pages/FirstPage/FirstPage.html",
            styleUrls: ["./Pages/FirstPage/FirstPage.css"]
        }),
        __metadata("design:paramtypes", [router_1.Router, page_1.Page, provider_1.Data])
    ], FirstPageComponent);
    return FirstPageComponent;
}());
exports.FirstPageComponent = FirstPageComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlyc3RQYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRmlyc3RQYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTBDO0FBQzFDLDBEQUF5RDtBQUN6RCwwQ0FBeUM7QUFDekMsZ0NBQStCO0FBQy9CLDJDQUFzQztBQUN0QyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUU1QztJQU1JO1FBRUksSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFFdkIsQ0FBQztJQUVMLFdBQUM7QUFBRCxDQUFDLEFBZEQsSUFjQztBQVFEO0lBT0ksNEJBQTJCLE1BQWMsRUFBVSxJQUFVLEVBQVUsSUFBVTtRQUF0RCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLFNBQUksR0FBSixJQUFJLENBQU07UUFFN0UsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLG1CQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztRQUNqQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztJQUUxQixDQUFDO0lBRUQsK0JBQUUsR0FBRjtRQUFBLGlCQVlDO1FBVkcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEVBQUU7WUFDOUIsRUFBRSxDQUFDLE9BQU8sQ0FBQyxvT0FBb08sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEVBQUU7Z0JBQ3BQLEtBQUksQ0FBQyxRQUFRLEdBQUcs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QUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNoRCxFQUFFLENBQUMsQ0FBQyxXQUFXLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3RCLENBQUM7WUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEtBQUssQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1lBQ2xFLENBQUM7WUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEtBQUssQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyw2Q0FBNkMsQ0FBQyxDQUFBO1lBQ3ZHLENBQUM7UUFDTCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUF4SVEsa0JBQWtCO1FBTjlCLGdCQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsV0FBVztZQUNyQixXQUFXLEVBQUUsa0NBQWtDO1lBQy9DLFNBQVMsRUFBRSxDQUFDLGlDQUFpQyxDQUFDO1NBQ2pELENBQUM7eUNBU3FDLGVBQU0sRUFBZ0IsV0FBSSxFQUFnQixlQUFJO09BUHhFLGtCQUFrQixDQTBJOUI7SUFBRCx5QkFBQztDQUFBLEFBMUlELElBMElDO0FBMUlZLGdEQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBVc2VyRGF0YSB9IGZyb20gXCIuLi8uLi9Vc2Vycy9Vc2VyRGF0YS9Vc2VyRGF0YVwiO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gXCJ1aS9wYWdlXCI7XG5pbXBvcnQgeyBEYXRhIH0gZnJvbSBcIi4uLy4uL3Byb3ZpZGVyXCI7XG52YXIgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XG5cbmNsYXNzIFVzZXJ7XG5cbiAgICB1c2VybmFtZTogc3RyaW5nOyBcbiAgICBlbWFpbDogc3RyaW5nOyBcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBcbiAgICAgICAgdGhpcy51c2VybmFtZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZW1haWwgPSBcIlwiO1xuICAgICAgICB0aGlzLnBhc3N3b3JkID0gXCJcIjtcblxuICAgIH1cblxufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJmaXJzdHBhZ2VcIixcbiAgICB0ZW1wbGF0ZVVybDogXCIuL1BhZ2VzL0ZpcnN0UGFnZS9GaXJzdFBhZ2UuaHRtbFwiLFxuICAgIHN0eWxlVXJsczogW1wiLi9QYWdlcy9GaXJzdFBhZ2UvRmlyc3RQYWdlLmNzc1wiXVxufSlcblxuZXhwb3J0IGNsYXNzIEZpcnN0UGFnZUNvbXBvbmVudCB7XG5cbiAgICBwcml2YXRlIGRhdGFiYXNlOiBhbnk7XG4gICAgdXNlckRhdGE6IFVzZXJEYXRhO1xuICAgIGFycmF5OiBBcnJheTxVc2VyPjtcbiAgICBpc0xvZ2dpbmc6IGJvb2xlYW47XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSBwYWdlOiBQYWdlLCBwcml2YXRlIGRhdGE6IERhdGEpIHtcblxuICAgICAgICB0aGlzLmFycmF5ID0gW107XG4gICAgICAgIHRoaXMudXNlckRhdGEgPSBuZXcgVXNlckRhdGEoXCJcIiwgXCJcIik7XG4gICAgICAgIHRoaXMuZGIoKTtcbiAgICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbiA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNMb2dnaW5nID0gdHJ1ZTtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgZGIoKTogdm9pZCB7XG5cbiAgICAgICAgKG5ldyBTcWxpdGUoXCJGaXRuZXNzLmRiXCIpKS50aGVuKGRiID0+IHtcbiAgICAgICAgICAgIGRiLmV4ZWNTUUwoXCJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBBY2NvdW50cyAoaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULCBlbWFpbCBURVhUIE5PVCBOVUxMLCB1c2VybmFtZSBURVhUIE5PVCBOVUxMLCBwYXNzd29yZCBURVhUIE5PVCBOVUxMLCBhZ2UgSU5URUdFUiwgZ2VuZGVyIFRFWFQsIGZvb3QgSU5URUdFUiwgaW5jaGVzIElOVEVHRVIsIHdlaWdodCBET1VCTEUsIGltYWdlIFRFWFQpXCIpLnRoZW4oaWQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcbiAgICAgICAgICAgICAgICB0aGlzLnJlYWRRdWVyeSgpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiREIgRVJST1JcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJEQiBFUlJPUlwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVhZFF1ZXJ5KCk6IHZvaWQge1xuXG4gICAgICAgIHZhciBpID0gMDtcbiAgICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIEFjY291bnRzXCIpLnRoZW4ocm93cyA9PiB7XG4gICAgICAgICAgICBmb3IgKHZhciByb3cgaW4gcm93cykge1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wVXNlciA9IG5ldyBVc2VyKCk7XG4gICAgICAgICAgICAgICAgdGVtcFVzZXIuZW1haWwgPSByb3dzW3Jvd11bMV07XG4gICAgICAgICAgICAgICAgdGVtcFVzZXIudXNlcm5hbWUgPSByb3dzW3Jvd11bMl07XG4gICAgICAgICAgICAgICAgdGVtcFVzZXIucGFzc3dvcmQgPSByb3dzW3Jvd11bM107XG4gICAgICAgICAgICAgICAgdGhpcy5hcnJheVtpXSA9IHRlbXBVc2VyO1xuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJTZWxlY3QgUXVlcnkgRXJyb3JcIik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHdyaXRlUXVlcnkoKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gQWNjb3VudHMgKGVtYWlsLCB1c2VybmFtZSwgcGFzc3dvcmQsIGFnZSwgZ2VuZGVyLCBmb290LCBpbmNoZXMsIHdlaWdodCwgaW1hZ2UpIFZBTFVFUyAoPywgPywgPywgPywgPywgPywgPywgPywgPylcIiwgW3RoaXMudXNlckRhdGEuZW1haWwsIHRoaXMudXNlckRhdGEudXNlcm5hbWUsIHRoaXMudXNlckRhdGEucGFzc3dvcmQsIHRoaXMudXNlckRhdGEuYWdlLCB0aGlzLnVzZXJEYXRhLmdlbmRlciwgdGhpcy51c2VyRGF0YS5mb290LCB0aGlzLnVzZXJEYXRhLmluY2hlcywgdGhpcy51c2VyRGF0YS53ZWlnaHQsIFwifi9JbWFnZXMvYmxhbmsucG5nXCJdKS50aGVuKGlkID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiWW91ciBBY2NvdW50IGhhcyBiZWVuIENyZWF0ZWQgU3VjY2Vzc2Z1bGx5ISFcIik7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUZvcm0oKTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJJbnNlcnQgUXVlcnkgRXJyb3JcIilcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY2hlY2tVc2VyKHVzZXI6IFVzZXJEYXRhKSB7XG4gICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy5hcnJheS5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgaWYgKHVzZXIuZW1haWwgPT0gdGhpcy5hcnJheVtrXS5lbWFpbCkge1xuICAgICAgICAgICAgICAgIGNvdW50ID0gMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh1c2VyLnVzZXJuYW1lID09IHRoaXMuYXJyYXlba10udXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjb3VudCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgIH1cblxuICAgIHRvZ2dsZUZvcm0oKSB7XG4gICAgICAgIHRoaXMuaXNMb2dnaW5nID0gIXRoaXMuaXNMb2dnaW5nO1xuICAgIH1cblxuICAgIGNsZWFyVGV4dGJveGVzKCl7XG4gICAgICAgIHRoaXMudXNlckRhdGEudXNlcm5hbWUgPSBcIlwiO1xuICAgICAgICB0aGlzLnVzZXJEYXRhLmVtYWlsID0gXCJcIjtcbiAgICAgICAgdGhpcy51c2VyRGF0YS5wYXNzd29yZCA9IFwiXCI7XG4gICAgfVxuXG4gICAgc3VibWl0KCkge1xuICAgICAgICBpZiAodGhpcy5pc0xvZ2dpbmcpIHtcbiAgICAgICAgICAgIHRoaXMubG9naW4oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2lnbnVwKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2dpbigpIHtcblxuICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICBpZiAoIXRoaXMudXNlckRhdGEudXNlcm5hbWUgfHwgIXRoaXMudXNlckRhdGEucGFzc3dvcmQpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiS2luZGx5IFByb3ZpZGUgRXZlcnkgRmllbGRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlYWRRdWVyeSgpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlckRhdGEudXNlcm5hbWUgPT09IHRoaXMuYXJyYXlbaV0udXNlcm5hbWUgJiYgdGhpcy51c2VyRGF0YS5wYXNzd29yZCA9PT0gdGhpcy5hcnJheVtpXS5wYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5zdG9yYWdlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VybmFtZVwiOiB0aGlzLmFycmF5W2ldLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiOiB0aGlzLmFycmF5W2ldLmVtYWlsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcIi9zZWNvbmRwYWdlXCJdKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICBhbGVydChcIkFjY291bnQgTm90IEZvdW5kXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2lnbnVwKCkge1xuXG4gICAgICAgIGlmICghdGhpcy51c2VyRGF0YS51c2VybmFtZSB8fCAhdGhpcy51c2VyRGF0YS5lbWFpbCB8fCAhdGhpcy51c2VyRGF0YS5wYXNzd29yZCB8fCAhdGhpcy51c2VyRGF0YS5hZ2UgfHwgIXRoaXMudXNlckRhdGEuZ2VuZGVyIHx8ICF0aGlzLnVzZXJEYXRhLmZvb3QgfHwgIXRoaXMudXNlckRhdGEuaW5jaGVzIHx8ICF0aGlzLnVzZXJEYXRhLndlaWdodCkge1xuICAgICAgICAgICAgYWxlcnQoXCJLaW5kbHkgUHJvdmlkZSBFdmVyeSBGaWVsZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjaGVja1Jlc3VsdCA9IHRoaXMuY2hlY2tVc2VyKHRoaXMudXNlckRhdGEpO1xuICAgICAgICAgICAgaWYgKGNoZWNrUmVzdWx0ID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLndyaXRlUXVlcnkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoZWNrUmVzdWx0ID09IDEpIHtcbiAgICAgICAgICAgICAgICBhbGVydChcIlVzZXJuYW1lIEFscmVhZHkgVGFrZW4uLi4uIEtpbmRseSBDaG9vc2UgYW5vdGhlciBvbmVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGVja1Jlc3VsdCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJBY2NvdW50IHdpdGggRW1haWw6IFwiICsgdGhpcy51c2VyRGF0YS5lbWFpbCArIFwiIEFscmVhZHkgQ3JlYXRlZC4uLkNhbiBub3QgQ3JlYXRlIE5ldyBPbmUhIVwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVhZFF1ZXJ5KCk7XG4gICAgfVxuXG59XG4iXX0=