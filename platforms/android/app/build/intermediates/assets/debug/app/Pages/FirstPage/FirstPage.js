"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var User_1 = require("../../Users/User/User");
var router_1 = require("@angular/router");
var page_1 = require("ui/page");
var provider_1 = require("../../provider");
var Sqlite = require("nativescript-sqlite");
var timerModule = require("tns-core-modules/timer");
var FirstPageComponent = /** @class */ (function () {
    function FirstPageComponent(router, page, data) {
        this.router = router;
        this.page = page;
        this.data = data;
        this.array = [];
        this.db();
        this.page.actionBarHidden = true;
        this.user = new User_1.User();
        this.isLogging = true;
    }
    FirstPageComponent.prototype.db = function () {
        var _this = this;
        (new Sqlite("Fitness.db")).then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS loginCredentials (id INTEGER PRIMARY KEY AUTOINCREMENT, email TEXT NOT NULL, username TEXT NOT NULL, password TEXT NOT NULL)").then(function (id) {
                _this.database = db;
                _this.readQuery();
            }, function (error) {
                alert("DB ERROR");
            });
        }, function (error) {
            alert("DB ERROR");
        });
    };
    FirstPageComponent.prototype.readQuery = function () {
        var _this = this;
        var i = 0;
        this.database.all("SELECT * FROM loginCredentials").then(function (rows) {
            for (var row in rows) {
                var tempUser = new User_1.User();
                tempUser.email = rows[row][1];
                tempUser.username = rows[row][2];
                tempUser.password = rows[row][3];
                _this.array[i] = tempUser;
                i++;
            }
        }, function (error) {
            alert("Select Query Error");
        });
    };
    FirstPageComponent.prototype.writeQuery = function () {
        var _this = this;
        this.database.execSQL("INSERT INTO loginCredentials (email, username, password) VALUES (?, ?, ?)", [this.user.email, this.user.username, this.user.password]).then(function (id) {
            alert("Your Account has been Created Successfully!!");
            _this.toggleForm();
        }, function (error) {
            alert("Insert Query Error");
        });
    };
    FirstPageComponent.prototype.checkUser = function (user) {
        var count = 0;
        for (var k = 0; k < this.array.length; k++) {
            if (user.email == this.array[k].email) {
                count = 2;
                break;
            }
            if (user.username == this.array[k].username) {
                count = 1;
            }
        }
        return count;
    };
    FirstPageComponent.prototype.toggleForm = function () {
        this.isLogging = !this.isLogging;
    };
    FirstPageComponent.prototype.clearTextboxes = function () {
        this.user.username = "";
        this.user.email = "";
        this.user.password = "";
    };
    FirstPageComponent.prototype.submit = function () {
        if (this.isLogging) {
            this.login();
        }
        else {
            this.signup();
        }
    };
    FirstPageComponent.prototype.login = function () {
        var count = 0;
        if (!this.user.username || !this.user.password) {
            alert("Kindly Provide Every Field");
            return;
        }
        else {
            this.readQuery();
            for (var i = 0; i < this.array.length; i++) {
                if (this.user.username === this.array[i].username && this.user.password === this.array[i].password) {
                    count = 1;
                    this.data.storage = {
                        "username": this.array[i].username,
                        "email": this.array[i].email
                    };
                    this.router.navigate(["/secondpage"]);
                    break;
                }
            }
            if (count == 0) {
                alert("Account Not Found");
            }
        }
    };
    FirstPageComponent.prototype.signup = function () {
        if (!this.user.username || !this.user.email || !this.user.password) {
            alert("Kindly Provide Every Field");
            return;
        }
        else {
            var checkResult = this.checkUser(this.user);
            if (checkResult == 0) {
                this.writeQuery();
            }
            else if (checkResult == 1) {
                alert("Username Already Taken.... Kindly Choose another one");
            }
            else if (checkResult == 2) {
                alert("Account with Email: " + this.user.email + " Already Created...Can not Create New One!!");
            }
        }
        this.readQuery();
    };
    FirstPageComponent = __decorate([
        core_1.Component({
            selector: "firstpage",
            templateUrl: "./Pages/FirstPage/FirstPage.html",
            styleUrls: ["./Pages/FirstPage/FirstPage.css"]
        }),
        __metadata("design:paramtypes", [router_1.Router, page_1.Page, provider_1.Data])
    ], FirstPageComponent);
    return FirstPageComponent;
}());
exports.FirstPageComponent = FirstPageComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlyc3RQYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRmlyc3RQYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWlFO0FBQ2pFLDhDQUE2QztBQUM3QywwQ0FBeUM7QUFDekMsZ0NBQStCO0FBQy9CLDJDQUFzQztBQUN0QyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUM1QyxJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQVF0RDtJQU9JLDRCQUEyQixNQUFjLEVBQVUsSUFBVSxFQUFVLElBQVU7UUFBdEQsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLFNBQUksR0FBSixJQUFJLENBQU07UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFNO1FBRTdFLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksV0FBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7SUFFMUIsQ0FBQztJQUVELCtCQUFFLEdBQUY7UUFBQSxpQkFZQztRQVZHLENBQUMsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxFQUFFO1lBQzlCLEVBQUUsQ0FBQyxPQUFPLENBQUMseUpBQXlKLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxFQUFFO2dCQUN6SyxLQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztnQkFDbkIsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3JCLENBQUMsRUFBRSxVQUFBLEtBQUs7Z0JBQ0osS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3RCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxF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QUM7WUFDUCxRQUFRLEVBQUUsV0FBVztZQUNyQixXQUFXLEVBQUUsa0NBQWtDO1lBQy9DLFNBQVMsRUFBRSxDQUFDLGlDQUFpQyxDQUFDO1NBQ2pELENBQUM7eUNBU3FDLGVBQU0sRUFBZ0IsV0FBSSxFQUFnQixlQUFJO09BUHhFLGtCQUFrQixDQTBJOUI7SUFBRCx5QkFBQztDQUFBLEFBMUlELElBMElDO0FBMUlZLGdEQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQXBwbGljYXRpb25Jbml0U3RhdHVzIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi4vLi4vVXNlcnMvVXNlci9Vc2VyXCI7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcInVpL3BhZ2VcIjtcbmltcG9ydCB7IERhdGEgfSBmcm9tIFwiLi4vLi4vcHJvdmlkZXJcIjtcbnZhciBTcWxpdGUgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXNxbGl0ZVwiKTtcbmNvbnN0IHRpbWVyTW9kdWxlID0gcmVxdWlyZShcInRucy1jb3JlLW1vZHVsZXMvdGltZXJcIik7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcImZpcnN0cGFnZVwiLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vUGFnZXMvRmlyc3RQYWdlL0ZpcnN0UGFnZS5odG1sXCIsXG4gICAgc3R5bGVVcmxzOiBbXCIuL1BhZ2VzL0ZpcnN0UGFnZS9GaXJzdFBhZ2UuY3NzXCJdXG59KVxuXG5leHBvcnQgY2xhc3MgRmlyc3RQYWdlQ29tcG9uZW50IHtcblxuICAgIHByaXZhdGUgZGF0YWJhc2U6IGFueVxuICAgIGFycmF5OiBBcnJheTxVc2VyPjtcbiAgICB1c2VyOiBVc2VyO1xuICAgIGlzTG9nZ2luZzogYm9vbGVhbjtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyLCBwcml2YXRlIHBhZ2U6IFBhZ2UsIHByaXZhdGUgZGF0YTogRGF0YSkge1xuXG4gICAgICAgIHRoaXMuYXJyYXkgPSBbXTtcbiAgICAgICAgdGhpcy5kYigpO1xuICAgICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFySGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgdGhpcy51c2VyID0gbmV3IFVzZXIoKTtcbiAgICAgICAgdGhpcy5pc0xvZ2dpbmcgPSB0cnVlO1xuICAgICAgICBcbiAgICB9XG5cbiAgICBkYigpOiB2b2lkIHtcblxuICAgICAgICAobmV3IFNxbGl0ZShcIkZpdG5lc3MuZGJcIikpLnRoZW4oZGIgPT4ge1xuICAgICAgICAgICAgZGIuZXhlY1NRTChcIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGxvZ2luQ3JlZGVudGlhbHMgKGlkIElOVEVHRVIgUFJJTUFSWSBLRVkgQVVUT0lOQ1JFTUVOVCwgZW1haWwgVEVYVCBOT1QgTlVMTCwgdXNlcm5hbWUgVEVYVCBOT1QgTlVMTCwgcGFzc3dvcmQgVEVYVCBOT1QgTlVMTClcIikudGhlbihpZCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhYmFzZSA9IGRiO1xuICAgICAgICAgICAgICAgIHRoaXMucmVhZFF1ZXJ5KCk7XG4gICAgICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJEQiBFUlJPUlwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBhbGVydChcIkRCIEVSUk9SXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZWFkUXVlcnkoKTogdm9pZCB7XG5cbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gbG9naW5DcmVkZW50aWFsc1wiKS50aGVuKHJvd3MgPT4ge1xuICAgICAgICAgICAgZm9yICh2YXIgcm93IGluIHJvd3MpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcFVzZXIgPSBuZXcgVXNlcigpO1xuICAgICAgICAgICAgICAgIHRlbXBVc2VyLmVtYWlsID0gcm93c1tyb3ddWzFdO1xuICAgICAgICAgICAgICAgIHRlbXBVc2VyLnVzZXJuYW1lID0gcm93c1tyb3ddWzJdO1xuICAgICAgICAgICAgICAgIHRlbXBVc2VyLnBhc3N3b3JkID0gcm93c1tyb3ddWzNdO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJyYXlbaV0gPSB0ZW1wVXNlcjtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiU2VsZWN0IFF1ZXJ5IEVycm9yXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB3cml0ZVF1ZXJ5KCk6IHZvaWQge1xuXG4gICAgICAgIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcIklOU0VSVCBJTlRPIGxvZ2luQ3JlZGVudGlhbHMgKGVtYWlsLCB1c2VybmFtZSwgcGFzc3dvcmQpIFZBTFVFUyAoPywgPywgPylcIiwgW3RoaXMudXNlci5lbWFpbCwgdGhpcy51c2VyLnVzZXJuYW1lLCB0aGlzLnVzZXIucGFzc3dvcmRdKS50aGVuKGlkID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiWW91ciBBY2NvdW50IGhhcyBiZWVuIENyZWF0ZWQgU3VjY2Vzc2Z1bGx5ISFcIik7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUZvcm0oKTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJJbnNlcnQgUXVlcnkgRXJyb3JcIilcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY2hlY2tVc2VyKHVzZXI6IFVzZXIpIHtcbiAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmFycmF5Lmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBpZiAodXNlci5lbWFpbCA9PSB0aGlzLmFycmF5W2tdLmVtYWlsKSB7XG4gICAgICAgICAgICAgICAgY291bnQgPSAyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHVzZXIudXNlcm5hbWUgPT0gdGhpcy5hcnJheVtrXS51c2VybmFtZSkge1xuICAgICAgICAgICAgICAgIGNvdW50ID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxuXG4gICAgdG9nZ2xlRm9ybSgpIHtcbiAgICAgICAgdGhpcy5pc0xvZ2dpbmcgPSAhdGhpcy5pc0xvZ2dpbmc7XG4gICAgfVxuXG4gICAgY2xlYXJUZXh0Ym94ZXMoKXtcbiAgICAgICAgdGhpcy51c2VyLnVzZXJuYW1lID0gXCJcIjtcbiAgICAgICAgdGhpcy51c2VyLmVtYWlsID0gXCJcIjtcbiAgICAgICAgdGhpcy51c2VyLnBhc3N3b3JkID0gXCJcIjtcbiAgICB9XG5cbiAgICBzdWJtaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzTG9nZ2luZykge1xuICAgICAgICAgICAgdGhpcy5sb2dpbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaWdudXAoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxvZ2luKCkge1xuXG4gICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgIGlmICghdGhpcy51c2VyLnVzZXJuYW1lIHx8ICF0aGlzLnVzZXIucGFzc3dvcmQpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiS2luZGx5IFByb3ZpZGUgRXZlcnkgRmllbGRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlYWRRdWVyeSgpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlci51c2VybmFtZSA9PT0gdGhpcy5hcnJheVtpXS51c2VybmFtZSAmJiB0aGlzLnVzZXIucGFzc3dvcmQgPT09IHRoaXMuYXJyYXlbaV0ucGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAxO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuc3RvcmFnZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcm5hbWVcIjogdGhpcy5hcnJheVtpXS51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIjogdGhpcy5hcnJheVtpXS5lbWFpbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvc2Vjb25kcGFnZVwiXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJBY2NvdW50IE5vdCBGb3VuZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNpZ251cCgpIHtcblxuICAgICAgICBpZiAoIXRoaXMudXNlci51c2VybmFtZSB8fCAhdGhpcy51c2VyLmVtYWlsIHx8ICF0aGlzLnVzZXIucGFzc3dvcmQpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiS2luZGx5IFByb3ZpZGUgRXZlcnkgRmllbGRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgY2hlY2tSZXN1bHQgPSB0aGlzLmNoZWNrVXNlcih0aGlzLnVzZXIpO1xuICAgICAgICAgICAgaWYgKGNoZWNrUmVzdWx0ID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLndyaXRlUXVlcnkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoZWNrUmVzdWx0ID09IDEpIHtcbiAgICAgICAgICAgICAgICBhbGVydChcIlVzZXJuYW1lIEFscmVhZHkgVGFrZW4uLi4uIEtpbmRseSBDaG9vc2UgYW5vdGhlciBvbmVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGVja1Jlc3VsdCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJBY2NvdW50IHdpdGggRW1haWw6IFwiICsgdGhpcy51c2VyLmVtYWlsICsgXCIgQWxyZWFkeSBDcmVhdGVkLi4uQ2FuIG5vdCBDcmVhdGUgTmV3IE9uZSEhXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWFkUXVlcnkoKTtcbiAgICB9XG5cbn1cbiJdfQ==