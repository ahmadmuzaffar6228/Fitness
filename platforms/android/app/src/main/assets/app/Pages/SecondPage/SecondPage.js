"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var UserData_1 = require("../../Users/UserData/UserData");
var provider_1 = require("../../provider");
var nativescript_camera_1 = require("nativescript-camera");
var imageSourceModule = require("image-source");
var fs = require("file-system");
var imagePicker = require("nativescript-imagepicker");
var router_1 = require("@angular/router");
var Sqlite = require("nativescript-sqlite");
var OpenUrl = require("nativescript-openurl");
var SecondPageComponent = /** @class */ (function () {
    function SecondPageComponent(data, router) {
        this.data = data;
        this.router = router;
        this.imageIsOn = false;
        this.hideIcons = false;
        var obj = JSON.parse(JSON.stringify(this.data.storage));
        this.userData = new UserData_1.UserData(obj.username, obj.email);
        this.userData.image = "~/Images/blank.png";
        this.progressValue = 0;
        this.db();
    }
    SecondPageComponent.prototype.db = function () {
        var _this = this;
        (new Sqlite("Fitness.db")).then(function (db) {
            _this.database = db;
            _this.readData();
        }, function (error) {
            alert("DB ERROR");
            console.log("error: ", error);
        });
    };
    SecondPageComponent.prototype.readData = function () {
        var _this = this;
        this.database.all("SELECT * FROM Accounts").then(function (rows) {
            for (var row in rows) {
                if (_this.userData.email === rows[row][1]) {
                    var temp = new UserData_1.UserData("", "");
                    _this.id = rows[row][0];
                    console.log("Id : ", rows[row][0]);
                    console.log("Id : ", _this.id);
                    temp.age = rows[row][4];
                    temp.gender = rows[row][5];
                    temp.foot = rows[row][6];
                    temp.inches = rows[row][7];
                    temp.weight = rows[row][8];
                    temp.image = rows[row][9];
                    temp.bmi = _this.bmiCalculator(temp.foot, temp.inches, temp.weight);
                    _this.setData(temp);
                }
            }
        }, function (error) {
            console.log("Error : ", error);
            alert("Read Query ERROR");
        });
    };
    SecondPageComponent.prototype.videos = function (number) {
        if (number == 1) {
            OpenUrl("https://www.youtube.com/watch?v=PBC4n4-YnuY&index=2&list=PLLXmeIOBkPXReEHegdHUUR1QojD_7-WK-");
        }
        else if (number == 2) {
            OpenUrl("https://www.youtube.com/watch?v=_CZqfFMxQ4I&index=2&list=PLLXmeIOBkPXSfVneRcF4wafTA_rgYPdXW");
        }
        else if (number == 3) {
            OpenUrl("https://www.youtube.com/watch?v=lA7dbOmxs5I&t=9s");
        }
        else if (number == 4) {
            OpenUrl("https://www.youtube.com/watch?v=tfI6gs1jrHs");
        }
        else if (number == 5) {
            OpenUrl("https://www.youtube.com/watch?v=aJXfalSciFg");
        }
        else if (number == 6) {
            OpenUrl("https://www.youtube.com/watch?v=eVG-KfxPPbk");
        }
    };
    SecondPageComponent.prototype.bmiCalculator = function (foot, inch, weight) {
        var height = this.convertToMeters(foot, inch);
        var bmi = (weight / (height * height));
        return bmi;
    };
    SecondPageComponent.prototype.convertToMeters = function (foot, inch) {
        var heightInMeters = ((foot * 12) + inch) * 0.0254;
        return heightInMeters;
    };
    /*;
    ;
    ;
    this.barColor = "#008000";
    ;*/
    SecondPageComponent.prototype.setData = function (temp) {
        this.userData.age = temp.age;
        this.userData.gender = temp.gender;
        this.userData.weight = temp.weight;
        this.userData.foot = temp.foot;
        this.userData.inches = temp.inches;
        this.userData.image = temp.image;
        this.userData.bmi = temp.bmi;
        if (this.userData.bmi < 18.5) {
            this.bmiCategory = "Underweight";
            this.barColor = "#00FFFF";
            this.progressValue = 75;
            this.helpString = "We Recommend you to have a healthy daily diet to gain weight!! BEST OF LUCK";
        }
        else if (this.userData.bmi >= 18.5 && this.userData.bmi < 25) {
            this.bmiCategory = "Normal Weight";
            this.barColor = "#8C489F";
            this.progressValue = 100;
            this.helpString = "You have decent Statistics!! KEEP IT UP";
        }
        else if (this.userData.bmi >= 25 && this.userData.bmi < 30) {
            this.bmiCategory = "Overweight";
            this.barColor = "#FFFF00";
            this.progressValue = 60;
            this.helpString = "We Recommend you to start health related exercises to lose weight!! BEST OF LUCK";
        }
        else if (this.userData.bmi > 30) {
            this.bmiCategory = "Obesity";
            this.barColor = "#FF0000";
            this.helpString = "We Recommend you to start jogging or running on treadmill to lose dangerous obesity!! BEST OF LUCK";
            this.progressValue = 40;
        }
    };
    SecondPageComponent.prototype.toggleImage = function () {
        this.imageIsOn = !this.imageIsOn;
    };
    SecondPageComponent.prototype.toggleIcons = function () {
        this.hideIcons = !this.hideIcons;
    };
    SecondPageComponent.prototype.uploadImage = function () {
        var that = this;
        this.toggleImage();
        var context = imagePicker.create({
            mode: "single"
        });
        context.authorize().then(function () {
            return context.present();
        }).then(function (selection) {
            selection.forEach(function (select) {
                that.userData.image = select._android;
            });
        }, function (error) {
            alert("Couldn't upload Image");
        });
    };
    SecondPageComponent.prototype.takeImage = function () {
        var that = this;
        this.toggleImage();
        var milliseconds = (new Date).getTime();
        nativescript_camera_1.takePicture({ width: 450, height: 450, cameraFacing: "front" }).then(function (img) {
            var source = new imageSourceModule.ImageSource();
            source.fromAsset(img).then(function (source) {
                var folder = fs.knownFolders.documents();
                var path = fs.path.join(folder.path, "SaveImage" + milliseconds + ".jpeg");
                var saved = source.saveToFile(path, "jpeg");
                that.userData.image = path;
            });
        });
    };
    SecondPageComponent.prototype.saveDetails = function () {
        var _this = this;
        this.imageIsOn = false;
        this.toggleIcons();
        this.database.execSQL("UPDATE Accounts SET age=?, foot=?, inches=?, weight=? , gender=? , image=? WHERE id=? ", [this.userData.age, this.userData.foot, this.userData.inches, this.userData.weight, this.userData.gender, this.userData.image, this.id]).then(function (id) {
            alert("Details Saved Successfully");
            _this.readData();
        }, function (error) {
            console.log("Error: ", error);
            alert("Update Query Error");
        });
    };
    SecondPageComponent.prototype.clearDetails = function () {
        var _this = this;
        this.imageIsOn = false;
        this.toggleIcons();
        var obj = JSON.parse(JSON.stringify(this.data.storage));
        this.userData = new UserData_1.UserData(obj.username, obj.email);
        this.userData.image = "~/Images/blank.png";
        this.database.execSQL("UPDATE Accounts SET age=?, foot=?, inches=?, weight=? , gender=? , image=? WHERE id=? ", [this.userData.age, this.userData.foot, this.userData.inches, this.userData.weight, this.userData.gender, this.userData.image, this.id]).then(function (id) {
            alert("Details Saved Successfully");
            _this.readData();
        }, function (error) {
            console.log("Error: ", error);
            alert("Clear Query Error");
        });
    };
    SecondPageComponent.prototype.logout = function () {
        this.router.navigate(["/firstpage"]);
    };
    SecondPageComponent.prototype.done = function () {
        this.toggleIcons();
    };
    SecondPageComponent.prototype.removeImage = function () {
        this.userData.image = "~/Images/blank.png";
        this.database.execSQL("UPDATE Accounts SET image=? WHERE id=? ", [this.userData.image, this.id]).then(function (id) {
            alert("Details Saved Successfully");
        }, function (error) {
            console.log("Error: ", error);
            alert("Update Query Error");
        });
    };
    SecondPageComponent.prototype.navigateToChangeCredentialsPage = function () {
        this.router.navigate(["/changecredentialspage"]);
    };
    SecondPageComponent = __decorate([
        core_1.Component({
            selector: "secondpage",
            templateUrl: "./Pages/SecondPage/SecondPage.html",
            styleUrls: ["./Pages/SecondPage/SecondPage.css"]
        }),
        __metadata("design:paramtypes", [provider_1.Data, router_1.Router])
    ], SecondPageComponent);
    return SecondPageComponent;
}());
exports.SecondPageComponent = SecondPageComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2Vjb25kUGFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlNlY29uZFBhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMEM7QUFDMUMsMERBQXlEO0FBQ3pELDJDQUFzQztBQUN0QywyREFBa0Q7QUFDbEQsZ0RBQWtEO0FBQ2xELElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUNoQyxJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN0RCwwQ0FBeUM7QUFDekMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFDNUMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFTOUM7SUFZSSw2QkFBMkIsSUFBVSxFQUFVLE1BQWM7UUFBbEMsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFFekQsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDdkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDdkIsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksbUJBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxvQkFBb0IsQ0FBQztRQUMzQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7SUFFZCxDQUFDO0lBRUQsZ0NBQUUsR0FBRjtRQUFBLGlCQVVDO1FBUkcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxZQUFZLENB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LENBQUM7SUFFRCw2REFBK0IsR0FBL0I7UUFFSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQztJQUVyRCxDQUFDO0lBelFRLG1CQUFtQjtRQU4vQixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFlBQVk7WUFDdEIsV0FBVyxFQUFFLG9DQUFvQztZQUNqRCxTQUFTLEVBQUUsQ0FBQyxtQ0FBbUMsQ0FBQztTQUNuRCxDQUFDO3lDQWNtQyxlQUFJLEVBQWtCLGVBQU07T0FacEQsbUJBQW1CLENBMlEvQjtJQUFELDBCQUFDO0NBQUEsQUEzUUQsSUEyUUM7QUEzUVksa0RBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFVzZXJEYXRhIH0gZnJvbSBcIi4uLy4uL1VzZXJzL1VzZXJEYXRhL1VzZXJEYXRhXCI7XG5pbXBvcnQgeyBEYXRhIH0gZnJvbSBcIi4uLy4uL3Byb3ZpZGVyXCI7XG5pbXBvcnQgeyB0YWtlUGljdHVyZSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtY2FtZXJhXCI7XG5pbXBvcnQgKiBhcyBpbWFnZVNvdXJjZU1vZHVsZSBmcm9tIFwiaW1hZ2Utc291cmNlXCI7XG52YXIgZnMgPSByZXF1aXJlKFwiZmlsZS1zeXN0ZW1cIik7XG52YXIgaW1hZ2VQaWNrZXIgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LWltYWdlcGlja2VyXCIpO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xudmFyIFNxbGl0ZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtc3FsaXRlXCIpO1xudmFyIE9wZW5VcmwgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LW9wZW51cmxcIik7XG5cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwic2Vjb25kcGFnZVwiLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vUGFnZXMvU2Vjb25kUGFnZS9TZWNvbmRQYWdlLmh0bWxcIixcbiAgICBzdHlsZVVybHM6IFtcIi4vUGFnZXMvU2Vjb25kUGFnZS9TZWNvbmRQYWdlLmNzc1wiXVxufSlcblxuZXhwb3J0IGNsYXNzIFNlY29uZFBhZ2VDb21wb25lbnQge1xuXG4gICAgaWQ6IGFueTtcbiAgICBkYXRhYmFzZTogYW55O1xuICAgIHVzZXJEYXRhOiBVc2VyRGF0YTtcbiAgICBpbWFnZUlzT246IGJvb2xlYW47XG4gICAgaGlkZUljb25zOiBib29sZWFuO1xuICAgIHByb2dyZXNzVmFsdWU6IG51bWJlcjtcbiAgICBibWlDYXRlZ29yeTogc3RyaW5nO1xuICAgIGhlbHBTdHJpbmc6IHN0cmluZztcbiAgICBiYXJDb2xvcjogc3RyaW5nO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YTogRGF0YSwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcikge1xuXG4gICAgICAgIHRoaXMuaW1hZ2VJc09uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZUljb25zID0gZmFsc2U7XG4gICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZGF0YS5zdG9yYWdlKSk7XG4gICAgICAgIHRoaXMudXNlckRhdGEgPSBuZXcgVXNlckRhdGEob2JqLnVzZXJuYW1lLCBvYmouZW1haWwpO1xuICAgICAgICB0aGlzLnVzZXJEYXRhLmltYWdlID0gXCJ+L0ltYWdlcy9ibGFuay5wbmdcIjtcbiAgICAgICAgdGhpcy5wcm9ncmVzc1ZhbHVlID0gMDtcbiAgICAgICAgdGhpcy5kYigpO1xuXG4gICAgfVxuXG4gICAgZGIoKTogdm9pZCB7XG5cbiAgICAgICAgKG5ldyBTcWxpdGUoXCJGaXRuZXNzLmRiXCIpKS50aGVuKGRiID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcbiAgICAgICAgICAgIHRoaXMucmVhZERhdGEoKTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJEQiBFUlJPUlwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3I6IFwiLCBlcnJvcik7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcmVhZERhdGEoKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIEFjY291bnRzXCIpLnRoZW4ocm93cyA9PiB7XG4gICAgICAgICAgICBmb3IgKGxldCByb3cgaW4gcm93cykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzZXJEYXRhLmVtYWlsID09PSByb3dzW3Jvd11bMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXAgPSBuZXcgVXNlckRhdGEoXCJcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaWQgPSByb3dzW3Jvd11bMF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSWQgOiBcIiwgcm93c1tyb3ddWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJZCA6IFwiLCB0aGlzLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5hZ2UgPSByb3dzW3Jvd11bNF07XG4gICAgICAgICAgICAgICAgICAgIHRlbXAuZ2VuZGVyID0gcm93c1tyb3ddWzVdO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wLmZvb3QgPSByb3dzW3Jvd11bNl07XG4gICAgICAgICAgICAgICAgICAgIHRlbXAuaW5jaGVzID0gcm93c1tyb3ddWzddO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wLndlaWdodCA9IHJvd3Nbcm93XVs4XTtcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbWFnZSA9IHJvd3Nbcm93XVs5XTtcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5ibWkgPSB0aGlzLmJtaUNhbGN1bGF0b3IodGVtcC5mb290LCB0ZW1wLmluY2hlcywgdGVtcC53ZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEodGVtcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIDogXCIsIGVycm9yKTtcbiAgICAgICAgICAgIGFsZXJ0KFwiUmVhZCBRdWVyeSBFUlJPUlwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmlkZW9zKG51bWJlcjogbnVtYmVyKSB7XG5cbiAgICAgICAgaWYgKG51bWJlciA9PSAxKSB7XG5cbiAgICAgICAgICAgIE9wZW5VcmwoXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVBCQzRuNC1ZbnVZJmluZGV4PTImbGlzdD1QTExYbWVJT0JrUFhSZUVIZWdkSFVVUjFRb2pEXzctV0stXCIpO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobnVtYmVyID09IDIpIHtcblxuICAgICAgICAgICAgT3BlblVybChcImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9X0NacWZGTXhRNEkmaW5kZXg9MiZsaXN0PVBMTFhtZUlPQmtQWFNmVm5lUmNGNHdhZlRBX3JnWVBkWFdcIik7XG5cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChudW1iZXIgPT0gMykge1xuXG4gICAgICAgICAgICBPcGVuVXJsKFwiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1sQTdkYk9teHM1SSZ0PTlzXCIpO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobnVtYmVyID09IDQpIHtcblxuICAgICAgICAgICAgT3BlblVybChcImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9dGZJNmdzMWpySHNcIik7XG5cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChudW1iZXIgPT0gNSkge1xuXG4gICAgICAgICAgICBPcGVuVXJsKFwiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1hSlhmYWxTY2lGZ1wiKTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG51bWJlciA9PSA2KSB7XG5cbiAgICAgICAgICAgIE9wZW5VcmwoXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PWVWRy1LZnhQUGJrXCIpO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGJtaUNhbGN1bGF0b3IoZm9vdDogbnVtYmVyLCBpbmNoOiBudW1iZXIsIHdlaWdodDogbnVtYmVyKTogbnVtYmVyIHtcblxuICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5jb252ZXJ0VG9NZXRlcnMoZm9vdCwgaW5jaCk7XG4gICAgICAgIGxldCBibWkgPSAod2VpZ2h0IC8gKGhlaWdodCAqIGhlaWdodCkpO1xuICAgICAgICByZXR1cm4gYm1pO1xuXG4gICAgfVxuXG4gICAgY29udmVydFRvTWV0ZXJzKGZvb3Q6IG51bWJlciwgaW5jaDogbnVtYmVyKTogbnVtYmVyIHtcblxuICAgICAgICBsZXQgaGVpZ2h0SW5NZXRlcnMgPSAoKGZvb3QgKiAxMikgKyBpbmNoKSAqIDAuMDI1NDtcbiAgICAgICAgcmV0dXJuIGhlaWdodEluTWV0ZXJzO1xuXG4gICAgfVxuXG4gICAgLyo7XG4gICAgO1xuICAgIDtcbiAgICB0aGlzLmJhckNvbG9yID0gXCIjMDA4MDAwXCI7XG4gICAgOyovXG5cblxuICAgIHNldERhdGEodGVtcDogVXNlckRhdGEpIHtcblxuICAgICAgICB0aGlzLnVzZXJEYXRhLmFnZSA9IHRlbXAuYWdlO1xuICAgICAgICB0aGlzLnVzZXJEYXRhLmdlbmRlciA9IHRlbXAuZ2VuZGVyO1xuICAgICAgICB0aGlzLnVzZXJEYXRhLndlaWdodCA9IHRlbXAud2VpZ2h0O1xuICAgICAgICB0aGlzLnVzZXJEYXRhLmZvb3QgPSB0ZW1wLmZvb3Q7XG4gICAgICAgIHRoaXMudXNlckRhdGEuaW5jaGVzID0gdGVtcC5pbmNoZXM7XG4gICAgICAgIHRoaXMudXNlckRhdGEuaW1hZ2UgPSB0ZW1wLmltYWdlO1xuICAgICAgICB0aGlzLnVzZXJEYXRhLmJtaSA9IHRlbXAuYm1pO1xuICAgICAgICBpZiAodGhpcy51c2VyRGF0YS5ibWkgPCAxOC41KSB7XG5cbiAgICAgICAgICAgIHRoaXMuYm1pQ2F0ZWdvcnkgPSBcIlVuZGVyd2VpZ2h0XCI7XG4gICAgICAgICAgICB0aGlzLmJhckNvbG9yID0gXCIjMDBGRkZGXCI7XG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzVmFsdWUgPSA3NTtcbiAgICAgICAgICAgIHRoaXMuaGVscFN0cmluZyA9IFwiV2UgUmVjb21tZW5kIHlvdSB0byBoYXZlIGEgaGVhbHRoeSBkYWlseSBkaWV0IHRvIGdhaW4gd2VpZ2h0ISEgQkVTVCBPRiBMVUNLXCI7XG5cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnVzZXJEYXRhLmJtaSA+PSAxOC41ICYmIHRoaXMudXNlckRhdGEuYm1pIDwgMjUpIHtcblxuICAgICAgICAgICAgdGhpcy5ibWlDYXRlZ29yeSA9IFwiTm9ybWFsIFdlaWdodFwiO1xuICAgICAgICAgICAgdGhpcy5iYXJDb2xvciA9IFwiIzhDNDg5RlwiO1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzc1ZhbHVlID0gMTAwO1xuICAgICAgICAgICAgdGhpcy5oZWxwU3RyaW5nID0gXCJZb3UgaGF2ZSBkZWNlbnQgU3RhdGlzdGljcyEhIEtFRVAgSVQgVVBcIjtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMudXNlckRhdGEuYm1pID49IDI1ICYmIHRoaXMudXNlckRhdGEuYm1pIDwgMzApIHtcblxuICAgICAgICAgICAgdGhpcy5ibWlDYXRlZ29yeSA9IFwiT3ZlcndlaWdodFwiO1xuICAgICAgICAgICAgdGhpcy5iYXJDb2xvciA9IFwiI0ZGRkYwMFwiO1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzc1ZhbHVlID0gNjA7XG4gICAgICAgICAgICB0aGlzLmhlbHBTdHJpbmcgPSBcIldlIFJlY29tbWVuZCB5b3UgdG8gc3RhcnQgaGVhbHRoIHJlbGF0ZWQgZXhlcmNpc2VzIHRvIGxvc2Ugd2VpZ2h0ISEgQkVTVCBPRiBMVUNLXCI7XG5cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnVzZXJEYXRhLmJtaSA+IDMwKSB7XG5cbiAgICAgICAgICAgIHRoaXMuYm1pQ2F0ZWdvcnkgPSBcIk9iZXNpdHlcIjtcbiAgICAgICAgICAgIHRoaXMuYmFyQ29sb3IgPSBcIiNGRjAwMDBcIjtcbiAgICAgICAgICAgIHRoaXMuaGVscFN0cmluZyA9IFwiV2UgUmVjb21tZW5kIHlvdSB0byBzdGFydCBqb2dnaW5nIG9yIHJ1bm5pbmcgb24gdHJlYWRtaWxsIHRvIGxvc2UgZGFuZ2Vyb3VzIG9iZXNpdHkhISBCRVNUIE9GIExVQ0tcIjtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDQwO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHRvZ2dsZUltYWdlKCkge1xuICAgICAgICB0aGlzLmltYWdlSXNPbiA9ICF0aGlzLmltYWdlSXNPbjtcbiAgICB9XG5cbiAgICB0b2dnbGVJY29ucygpIHtcbiAgICAgICAgdGhpcy5oaWRlSWNvbnMgPSAhdGhpcy5oaWRlSWNvbnM7XG4gICAgfVxuXG4gICAgdXBsb2FkSW1hZ2UoKSB7XG5cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLnRvZ2dsZUltYWdlKCk7XG4gICAgICAgIGxldCBjb250ZXh0ID0gaW1hZ2VQaWNrZXIuY3JlYXRlKHtcbiAgICAgICAgICAgIG1vZGU6IFwic2luZ2xlXCJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnRleHQuYXV0aG9yaXplKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY29udGV4dC5wcmVzZW50KCk7XG4gICAgICAgIH0pLnRoZW4oKHNlbGVjdGlvbikgPT4ge1xuICAgICAgICAgICAgc2VsZWN0aW9uLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdCkge1xuICAgICAgICAgICAgICAgIHRoYXQudXNlckRhdGEuaW1hZ2UgPSBzZWxlY3QuX2FuZHJvaWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJDb3VsZG4ndCB1cGxvYWQgSW1hZ2VcIik7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgdGFrZUltYWdlKCkge1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy50b2dnbGVJbWFnZSgpO1xuICAgICAgICB2YXIgbWlsbGlzZWNvbmRzID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG4gICAgICAgIHRha2VQaWN0dXJlKHsgd2lkdGg6IDQ1MCwgaGVpZ2h0OiA0NTAsIGNhbWVyYUZhY2luZzogXCJmcm9udFwiIH0pLnRoZW4oZnVuY3Rpb24gKGltZykge1xuICAgICAgICAgICAgbGV0IHNvdXJjZSA9IG5ldyBpbWFnZVNvdXJjZU1vZHVsZS5JbWFnZVNvdXJjZSgpO1xuICAgICAgICAgICAgc291cmNlLmZyb21Bc3NldChpbWcpLnRoZW4oKHNvdXJjZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBmb2xkZXIgPSBmcy5rbm93bkZvbGRlcnMuZG9jdW1lbnRzKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhdGggPSBmcy5wYXRoLmpvaW4oZm9sZGVyLnBhdGgsIFwiU2F2ZUltYWdlXCIgKyBtaWxsaXNlY29uZHMgKyBcIi5qcGVnXCIpO1xuICAgICAgICAgICAgICAgIHZhciBzYXZlZCA9IHNvdXJjZS5zYXZlVG9GaWxlKHBhdGgsIFwianBlZ1wiKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVzZXJEYXRhLmltYWdlID0gcGF0aDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHNhdmVEZXRhaWxzKCkge1xuXG4gICAgICAgIHRoaXMuaW1hZ2VJc09uID0gZmFsc2U7XG4gICAgICAgIHRoaXMudG9nZ2xlSWNvbnMoKTtcbiAgICAgICAgdGhpcy5kYXRhYmFzZS5leGVjU1FMKFwiVVBEQVRFIEFjY291bnRzIFNFVCBhZ2U9PywgZm9vdD0/LCBpbmNoZXM9Pywgd2VpZ2h0PT8gLCBnZW5kZXI9PyAsIGltYWdlPT8gV0hFUkUgaWQ9PyBcIiwgW3RoaXMudXNlckRhdGEuYWdlLCB0aGlzLnVzZXJEYXRhLmZvb3QsIHRoaXMudXNlckRhdGEuaW5jaGVzLCB0aGlzLnVzZXJEYXRhLndlaWdodCwgdGhpcy51c2VyRGF0YS5nZW5kZXIsIHRoaXMudXNlckRhdGEuaW1hZ2UsIHRoaXMuaWRdKS50aGVuKGlkID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiRGV0YWlscyBTYXZlZCBTdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICB0aGlzLnJlYWREYXRhKCk7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3I6IFwiLCBlcnJvcik7XG4gICAgICAgICAgICBhbGVydChcIlVwZGF0ZSBRdWVyeSBFcnJvclwiKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBjbGVhckRldGFpbHMoKSB7XG5cbiAgICAgICAgdGhpcy5pbWFnZUlzT24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy50b2dnbGVJY29ucygpO1xuICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGEuc3RvcmFnZSkpO1xuICAgICAgICB0aGlzLnVzZXJEYXRhID0gbmV3IFVzZXJEYXRhKG9iai51c2VybmFtZSwgb2JqLmVtYWlsKTtcbiAgICAgICAgdGhpcy51c2VyRGF0YS5pbWFnZSA9IFwifi9JbWFnZXMvYmxhbmsucG5nXCI7XG4gICAgICAgIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcIlVQREFURSBBY2NvdW50cyBTRVQgYWdlPT8sIGZvb3Q9PywgaW5jaGVzPT8sIHdlaWdodD0/ICwgZ2VuZGVyPT8gLCBpbWFnZT0/IFdIRVJFIGlkPT8gXCIsIFt0aGlzLnVzZXJEYXRhLmFnZSwgdGhpcy51c2VyRGF0YS5mb290LCB0aGlzLnVzZXJEYXRhLmluY2hlcywgdGhpcy51c2VyRGF0YS53ZWlnaHQsIHRoaXMudXNlckRhdGEuZ2VuZGVyLCB0aGlzLnVzZXJEYXRhLmltYWdlLCB0aGlzLmlkXSkudGhlbihpZCA9PiB7XG4gICAgICAgICAgICBhbGVydChcIkRldGFpbHMgU2F2ZWQgU3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgICAgICAgdGhpcy5yZWFkRGF0YSgpO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yOiBcIiwgZXJyb3IpO1xuICAgICAgICAgICAgYWxlcnQoXCJDbGVhciBRdWVyeSBFcnJvclwiKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBsb2dvdXQoKSB7XG5cbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW1wiL2ZpcnN0cGFnZVwiXSk7XG5cbiAgICB9XG5cbiAgICBkb25lKCkge1xuXG4gICAgICAgIHRoaXMudG9nZ2xlSWNvbnMoKTtcblxuICAgIH1cblxuICAgIHJlbW92ZUltYWdlKCkge1xuXG4gICAgICAgIHRoaXMudXNlckRhdGEuaW1hZ2UgPSBcIn4vSW1hZ2VzL2JsYW5rLnBuZ1wiO1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXCJVUERBVEUgQWNjb3VudHMgU0VUIGltYWdlPT8gV0hFUkUgaWQ9PyBcIiwgW3RoaXMudXNlckRhdGEuaW1hZ2UsIHRoaXMuaWRdKS50aGVuKGlkID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiRGV0YWlscyBTYXZlZCBTdWNjZXNzZnVsbHlcIik7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3I6IFwiLCBlcnJvcik7XG4gICAgICAgICAgICBhbGVydChcIlVwZGF0ZSBRdWVyeSBFcnJvclwiKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBuYXZpZ2F0ZVRvQ2hhbmdlQ3JlZGVudGlhbHNQYWdlKCkge1xuXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcIi9jaGFuZ2VjcmVkZW50aWFsc3BhZ2VcIl0pO1xuXG4gICAgfVxuXG59XG4iXX0=